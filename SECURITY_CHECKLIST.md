# SECURITY CHECKLIST — MAX Contest Bot

Короткий чеклист перед локальным/серверным релизом.

## 1) Конфигурация и секреты

- [ ] `BOT_TOKEN` задан и не хранится в публичных репозиториях.
- [ ] `ADMIN_PANEL_SECRET` задан (в проде не использовать fallback на `BOT_TOKEN`).
- [ ] `OWNER_USER_ID` и `ADMIN_USER_IDS` заполнены корректными ID.
- [ ] `.env` не добавлен в git и не передается третьим лицам.

## 2) Доступ к админ-панели

- [ ] `ADMIN_PANEL_URL` использует публичный `https` URL для MAX-кнопок.
- [ ] `ADMIN_PANEL_TOKEN_TTL_MS` установлен в разумный диапазон (обычно 5-15 минут).
- [ ] `ADMIN_PANEL_RATE_LIMIT_*` включены (window + max запросов).
- [ ] `ADMIN_PANEL_IP_ALLOWLIST` заполнен для прода (если есть фиксированные IP).

## 3) Runtime-устойчивость

- [ ] Проверен graceful shutdown (`SIGINT`/`SIGTERM`) без зависших процессов.
- [ ] `/health` возвращает `ok`.
- [ ] `/health/ready` возвращает JSON со `status=ready`.
- [ ] В логах нет `unhandled_rejection` и `uncaught_exception`.

## 4) Бизнес-логика и анти-абьюз

- [ ] Команды `draw/reroll` доступны только разрешенным ролям.
- [ ] Кулдауны команд работают и не мешают нормальному UX.
- [ ] Referral-лимиты применяются корректно (`REFERRAL_*`).
- [ ] Proof-механика доступна через `/proof contest_id`.

## 5) Инфраструктура и операции

- [ ] `npm run test` полностью зеленый.
- [ ] Smoke-проверка проходит (`npm run smoke`).
- [ ] Настроен бэкап `data/contests.db`.
- [ ] Проверен сценарий восстановления после падения процесса.

## 6) Финальное решение о релизе

- [ ] Сформирован релизный коммит.
- [ ] Обновлен `CHANGELOG.md`.
- [ ] Подтверждено, что пользовательские инструкции в `README.md` актуальны.
