# MAX Contest Bot — Мастер-план проекта

Документ для junior fullstack-разработчика: куда идём, что делаем, как, зачем и сколько зарабатываем.

---

## 1. Цели по SMART (SmartSER)

**SMART** — чёткие цели: **S**pecific, **M**easurable, **A**chievable, **R**elevant, **T**ime-bound.

| SMART | Цель | Объяснение |
|-------|------|------------|
| **S**pecific | Запустить бота для конкурсов в MAX | Один продукт, одна платформа, один основной сценарий |
| **M**easurable | 50+ активных конкурсов, 500+ участников | Можно считать в статистике |
| **A**chievable | MVP за 2–4 недели | Реалистично для junior при поддержке |
| **R**elevant | Опыт с ботами, API, TypeScript | Полезно для карьеры и портфолио |
| **T**ime-bound | MVP к концу февраля 2026 | Понятный дедлайн |

**Итог:** К концу февраля — рабочий бот, который проводят конкурсы и можно показывать в портфолио.

---

## 2. Agile-план (спринты)

**Agile** — итеративная разработка: короткие циклы (спринты), постоянная обратная связь, приоритет по ценности.

### Спринт 1 (2 недели) — «Рабочий MVP» ✅ почти готов

| Задача | Статус | Зачем |
|--------|--------|-------|
| Core-команды | ✅ | Чтобы админ мог создавать конкурсы и проводить розыгрыши |
| Проверка подписок | ✅ | Чтобы участвовали только подписчики каналов |
| Рефералка | ~ | Рост через приглашения, больше охвата |
| Тесты | ✅ | Меньше багов, уверенность при изменениях |

### Спринт 2 (1–2 недели) — «Надёжность и защита»

| Задача | Приоритет | Зачем |
|--------|-----------|-------|
| `/start` payload для рефералов | высокий | Удобная ссылка для приглашений |
| Защита от спама/дублей | высокий | Чтобы бот не ломался от злоупотреблений |
| Редактирование конкурса | средний | Админ может исправить опечатку или дату |
| Логирование | средний | Понятно, что происходит при ошибках |

### Спринт 3 (2 недели) — «Продакшен»

| Задача | Приоритет | Зачем |
|--------|-----------|-------|
| SQLite вместо JSON | высокий | Надёжное хранение при росте данных |
| Деплой (VPS/Docker) | высокий | Бот работает 24/7 без твоего компьютера |
| Документация | средний | Можно отдать бота другому человеку |

### Спринт 4 (по желанию) — «Монетизация»

| Задача | Приоритет | Зачем |
|--------|-----------|-------|
| Freemium-тарифы | опционально | Бесплатно — 1 конкурс, платно — больше |
| Оплата (ЮKassa/Stripe) | опционально | Автоматический приём платежей |

---

## 3. Монетизация: сколько можно зарабатывать

### Варианты заработка

| Модель | Описание | Реалистичный доход (в месяц) |
|--------|----------|------------------------------|
| **B2B: продажа бота** | Продолжение поддержки за фикс | 5–30 тыс. ₽ |
| **Подписка** | 200–500 ₽/мес за неограниченные конкурсы | 5–20 тыс. ₽ при 20–50 клиентах |
| **Комиссия с розыгрышей** | 5–10% от призового фонда | Зависит от клиентов |
| **Интеграция в агентство** | Бот как часть услуги SMM | 10–50 тыс. ₽ за проект |

### Этапы к доходу

1. **Сейчас:** Продукт для портфолио, бесплатно.
2. **Через 1–2 месяца:** Пилотные клиенты (каналы, бренды) — бартер или символическая оплата.
3. **Через 3–6 месяцев:** 5–10 платных клиентов → 5–15 тыс. ₽/мес.
4. **Дальше:** Рост через рефералов и маркетинг.

---

## 4. Технический стек — что и зачем

### Текущий стек (уже стоит)

| Технология | Роль | Зачем junior |
|------------|------|---------------|
| **Node.js** | Среда выполнения | Самый популярный backend для JS |
| **TypeScript** | Язык | Меньше ошибок, автодополнение |
| **@maxhub/max-bot-api** | SDK для MAX | Официальный способ работы с API |
| **Zod** | Валидация | Безопасная проверка `.env` |
| **JSON-файл** | Хранение данных | Просто для старта, без БД |

### Что добавить поэтапно

| Этап | Технология | Зачем |
|------|------------|-------|
| Сейчас | Node + TypeScript | Достаточно для MVP |
| Спринт 2 | — | Оставляем JSON, фокус на функциях |
| Спринт 3 | **SQLite** (better-sqlite3) | Простая БД, файл на диске |
| Спринт 3 | **Docker** | Типовой способ деплоя |
| Позже | **PostgreSQL** | Если вырастет нагрузка |

### Почему не другой стек

- **Не React/Vue во фронте** — бот работает в мессенджере, UI текстовый.
- **Не Python** — MAX SDK для Node, экосистема JS/TS привычнее.
- **Не MongoDB** — сначала SQLite, потом PostgreSQL при необходимости.

---

## 5. Как устроено: пошаговое объяснение

### 5.1. Запуск бота

```
npm run dev  →  tsx src/index.ts  →  loadConfig()  →  createContestBot()  →  bot.start()
```

**Что происходит:**

1. `npm run dev` — запускает скрипт из `package.json`.
2. `tsx` — компилирует TypeScript на лету без отдельного `tsc`.
3. `loadConfig()` — читает `.env`, проверяет через Zod.
4. `createContestBot()` — создаёт объект бота и подписывает его на команды.
5. `bot.start()` — подключение к MAX API и ожидание обновлений.

### 5.2. Откуда берутся команды

```
Пользователь пишет /join abc123
    ↓
MAX server отправляет update на наш сервер (webhook/polling)
    ↓
bot.command("join", handler) срабатывает
    ↓
handler получает ctx (контекст: user, message, chat)
    ↓
tryJoinContest() проверяет условия и добавляет участника
    ↓
repository.addParticipant() сохраняет в JSON
    ↓
ctx.reply("Вы участвуете!") отвечает пользователю
```

**Зачем:**
- Разделение: обработчик → бизнес-логика → хранилище.
- Легко менять логику и добавлять новые команды.

### 5.3. Жеребьёвка (draw)

```
/draw contest_id
    ↓
runDeterministicDraw(contest)
    ↓
seed = hash(contest.id + endsAt + participants.length)
    ↓
Каждый участник × tickets = список «билетов»
    ↓
Сортируем билеты по hash(seed, билет) — детерминированно
    ↓
Берём первые maxWinners уникальных userId
    ↓
Результат: seed + winners (можно проверить позже)
```

**Зачем детерминированность:** Любой может пересчитать результат по seed и убедиться, что победители честные.

### 5.4. Хранение данных

```
data/contests.json
{
  "contests": [
    {
      "id": "abc123",
      "title": "Розыгрыш iPhone",
      "participants": [...],
      "winners": [...]
    }
  ]
}
```

**Зачем JSON сначала:** Просто открыть, посмотреть, отладить. Позже — SQLite для надёжности и масштаба.

---

## 6. Чек-лист перед каждым шагом

Для каждого изменения:

1. **Зачем?** — Какую задачу из TASKS.md это закрывает.
2. **Где менять?** — Файл/функция.
3. **Как проверить?** — `npm run test`, ручная проверка в боте.
4. **Коммит?** — Да, если тесты зелёные.

---

## 7. Связь документов

| Документ | Роль |
|----------|------|
| **PLAN.md** (этот) | Стратегия, цели, Agile, стек, объяснения |
| **TASKS.md** | Текущие задачи, статус, ограничения API |
| **README.md** | Как запустить и использовать бота |

---

## 8. Резюме для junior

- **Цель:** Рабочий бот конкурсов в MAX к концу февраля.
- **Как:** Короткие спринты, тесты, коммиты после каждого шага.
- **Заработок:** Сначала портфолио, потом пилоты, потом 5–15 тыс. ₽/мес.
- **Стек:** Node + TypeScript, SQLite позже, Docker для деплоя.
- **Каждый шаг:** Зачем → Где → Как проверить → Коммит.
