# MAX Contest Bot

Contest-бот для MAX с механикой розыгрышей.

## Реализовано в MVP

- Создание конкурса командой `/newcontest`.
- Вступление участника командой `/join`.
- Вступление через inline-кнопку "Участвовать".
- Проверка участия в обязательных чатах перед регистрацией.
- Реферальные бонусные билеты и взвешенная жеребьевка.
- Публикация конкурсного поста командой `/publish`.
- Список конкурсов `/contests`.
- Детерминированная жеребьевка `/draw`.
- Повторная жеребьевка `/reroll`.
- Автозавершение просроченных конкурсов.
- Хранение в JSON-файле.

## Быстрый старт

```bash
npm install
cp .env.example .env
npm run dev
```

Заполните в `.env`:

- `BOT_TOKEN` - токен бота MAX.
- `ADMIN_USER_IDS` - ID админов через запятую.

## Формат создания конкурса

```text
/newcontest Название конкурса | 2026-12-31T20:00:00Z | 3
```

## Публикация конкурсного поста

```text
/publish contest_id chat_id [текст поста]
```

## Админ-управление конкурсом

```text
/editcontest contest_id | title|- | endsAt|- | winners|-
/closecontest contest_id
/reopencontest contest_id 2026-12-31T20:00:00Z
```

- `editcontest` меняет параметры существующего конкурса.
- `closecontest` принудительно завершает конкурс (с розыгрышем, если есть участники).
- `reopencontest` открывает завершенный конкурс заново с новой датой окончания.

## Настройка обязательных чатов

```text
/setrequired contest_id chat_id[,chat_id2,...]
```

После установки бот проверяет членство пользователя в этих чатах при `/join` и по кнопке участия.

## Рефералка и бонусные билеты

```text
/myref contest_id
/join contest_id referrer_user_id
/start join:contest_id:referrer_user_id
```

- Базово у каждого участника 1 билет.
- За валидного приглашенного участника рефереру добавляется бонус:
  - `REFERRAL_BONUS_TICKETS` за каждого приглашенного.
  - Но не больше `REFERRAL_MAX_BONUS_TICKETS` суммарно на одного пользователя.
- Жеребьевка учитывает число билетов (weighted draw), при этом победители уникальны.
- `/start` поддерживает payload для участия через реферальную ссылку/формат.
- Встроены базовые анти-абьюз механики: cooldown на частые команды и защита от дублей draw/reroll.
